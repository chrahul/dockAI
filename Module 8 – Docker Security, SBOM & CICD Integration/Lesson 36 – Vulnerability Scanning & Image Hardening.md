
#  **Module 8 – Docker Security, SBOM & CI/CD Integration**

## **Lesson 36 – Vulnerability Scanning & Image Hardening**

<img width="1536" height="1024" alt="image" src="https://github.com/user-attachments/assets/7c52fdf7-5817-4baf-b679-b3ca350201aa" />

---

##  **Learning Objective**

Learn how to **identify, fix, and prevent vulnerabilities** in Docker images using scanning tools like **Trivy** and **Grype**, and apply **image-hardening best practices** to reduce your container attack surface before deployment.

---

##  **1. Why Image Scanning Matters**

In modern CI/CD pipelines, most security issues don’t come from your code —
they come from the **base images** you use.

A single vulnerable library in your image (like OpenSSL or glibc) can expose your entire application.

> Security isn’t only about firewalls — it starts with the images you pull.

Every `docker pull` is a trust decision.
You’re inheriting someone else’s dependencies, binaries, and potential CVEs.

That’s why image scanning is critical — it tells you **what’s inside** your containers before production does.

---

##  **2. What Are Vulnerability Scanners?**

Vulnerability scanners analyze your Docker images layer by layer and report known **CVE (Common Vulnerabilities and Exposures)** using continuously updated security databases.

### Popular Tools:

| Tool             | Maintained By | Highlights                              |
| ---------------- | ------------- | --------------------------------------- |
| **Trivy**        | Aqua Security | Simple, fast, integrates with CI/CD     |
| **Grype**        | Anchore       | SBOM-based scanning, customizable       |
| **Docker Scout** | Docker Inc.   | Built-in insights within Docker Desktop |

---

##  **3. Installing and Running Trivy**

### **Install Trivy**

```bash
sudo apt install wget -y
wget https://github.com/aquasecurity/trivy/releases/latest/download/trivy_Linux-64bit.deb
sudo dpkg -i trivy_Linux-64bit.deb
```

### **Scan a Local Image**

```bash
trivy image nginx:latest
```

Example Output:

```
nginx:latest (debian 11)
=========================
Total: 18 (HIGH: 4, MEDIUM: 7, LOW: 7)
→ libssl1.1  - CVE-2023-2650 (HIGH)
→ zlib       - CVE-2022-37434 (MEDIUM)
```

Trivy categorizes issues by severity and CVE ID, helping prioritize patching.

---

##  **4. Fixing Vulnerabilities**

**Option 1: Update Your Base Image**

```dockerfile
FROM nginx:latest
→ change to
FROM nginx:1.25-alpine
```

Alpine images are lighter and usually contain fewer CVEs.

**Option 2: Use Multi-Stage Builds**

```dockerfile
# Stage 1: Build
FROM golang:1.20 AS builder
WORKDIR /app
COPY . .
RUN go build -o myapp

# Stage 2: Runtime
FROM alpine:latest
COPY --from=builder /app/myapp /myapp
CMD ["/myapp"]
```

 Only the compiled binary is copied — no build tools, no extra packages, minimal attack surface.

**Option 3: Rebuild Regularly**

* Automate rebuilds weekly.
* Re-run scans before every deployment.
* Integrate into Jenkins/GitHub pipeline.

---

##  **5. Grype for Advanced Scanning**

Install:

```bash
curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh
```

Scan an image:

```bash
grype nginx:1.25
```

Example Output:

```
Found 10 vulnerabilities
CVE-2023-27536 (HIGH) - glibc
CVE-2022-37434 (MEDIUM) - zlib
```

Grype can also scan **SBOMs** generated by Syft or Trivy, making it CI/CD friendly and transparent.

---

##  **6. Hardening Your Docker Images**

Security is not only about fixing vulnerabilities — it’s about **preventing them**.

###  Image Hardening Best Practices

| Practice                      | Description                                                 |
| ----------------------------- | ----------------------------------------------------------- |
| **Use minimal base images**   | Alpine, Distroless, or scratch images reduce attack surface |
| **Multi-stage builds**        | Avoid shipping compilers and build tools in runtime images  |
| **Avoid running as root**     | Always use `USER` directive in Dockerfile                   |
| **Pin versions**              | Avoid floating tags like `latest`                           |
| **Scan early & often**        | Integrate scanners into your CI/CD                          |
| **Use verified images**       | Prefer official or signed base images                       |
| **Set resource limits**       | Prevent DoS through runaway containers                      |
| **Read-only root filesystem** | Prevent file system tampering                               |

Example:

```dockerfile
FROM alpine:3.18
RUN adduser -D appuser
USER appuser
WORKDIR /app
COPY app .
CMD ["./app"]
```

---

##  **7. Integrating Scanning into CI/CD**

### **Trivy in Jenkins**

```groovy
stage('Scan Image') {
  steps {
    sh 'trivy image myapp:latest || true'
  }
}
```

### **Trivy in GitHub Actions**

```yaml
- name: Scan Docker image
  uses: aquasecurity/trivy-action@master
  with:
    image-ref: myapp:latest
```

 If vulnerabilities exceed a threshold, you can automatically **fail the build** or **notify security teams.**

---

##  **8. Visual Summary**

```
┌────────────────────────────────────────────┐
│              Build Stage                   │
│  - Dockerfile Hardening                    │
│  - Non-root user                           │
│  - Minimal base image                      │
└─────────────────────────────┬──────────────┘
                              │
               Image Scanning (Trivy / Grype)
                              │
┌─────────────────────────────▼────────────────────┐
│                 CI/CD Pipeline                  │
│  - Jenkins / GitHub Actions                     │
│  - Scan → Report → Fix → Rebuild                │
│  - Fail build on critical vulnerabilities       │
└────────────────────────────────────────────────┘
```

---

##  **9. Summary**

| **Concept**            | **Key Takeaway**                                            |
| ---------------------- | ----------------------------------------------------------- |
| **Trivy / Grype**      | Detect vulnerabilities in base and app layers               |
| **Hardening**          | Reduce attack surface using minimal and non-root images     |
| **Multi-stage builds** | Isolate build tools from production images                  |
| **CI/CD Scanning**     | Automate vulnerability detection in pipelines               |
| **Goal**               | Shift security left — build secure containers before deploy |

---

##  **Next Lesson Preview – Lesson 37**

> **Software Bill of Materials (SBOM) & Supply Chain Security**
> Learn how to generate and verify SBOMs, sign your images, and ensure supply chain transparency for every deployment.

